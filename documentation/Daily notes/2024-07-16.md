#daily 
### **1. Task Creation**

- **Issue**: You needed to create a task through a form and API request, but the form data handling and API requests werenâ€™t functioning as expected.
- **Solution**:
    - Updated the `task_create` view function to use `requests.post` with appropriate data and headers.
    - Ensured the data sent to the API was correctly formatted.
    - Added error handling to display appropriate messages if task creation failed.

**Updated `task_create` View Function:**

python

Code kopieren

`@login_required def task_create(request):     if request.method == 'POST':         data = {             'title' : request.POST.get('title'),             'description' : request.POST.get('description'),             'status' : request.POST.get('status'),             'assignee' : request.POST.get('assignee'),             'startDate' : request.POST.get('startDate'),             'deadline' : request.POST.get('deadline'),             'priority' : request.POST.get('priority')         }          refresh = RefreshToken.for_user(request.user)         access_token = str(refresh.access_token)         headers = {'Authorization': f'Bearer {access_token}'}          response = requests.post(f'http://localhost:8000/api/tasks/', data=data, headers=headers)          if response.status_code == 201:             assignee_email = response.json().get('assignee_email')             send_task_email_to_assignee(assignee_email, data['title'])             return redirect('tasklist')         else:             print(f"Error: {response.status_code} - {response.text}")             return render(request, 'tasklist_create.html', {'error': response.json()})     else:         users = User.objects.all()         statuses = Task.Status.choices         priorities = Task.Priority.choices         return render(request, 'tasklist_create.html', {'users':users, 'statuses':statuses, 'priorities':priorities})`

### **2. Task Update**

- **Issue**: You faced problems with the `PUT` method requiring all fields to be populated, and you needed to use `PATCH` for partial updates.
- **Solution**:
    - Updated the `task_update` view function to use `requests.patch` for partial updates.
    - Added logic to filter out empty fields in the data being sent.

**Updated `task_update` View Function:**

python

Code kopieren

`@login_required def task_update(request, task_id):     current_task = get_object_or_404(Task, pk=task_id)     if request.method == 'POST':         data = {             'title' : request.POST.get('title'),             'description' : request.POST.get('description'),             'status' : request.POST.get('status'),             'assignee' : request.POST.get('assignee'),             'startDate' : request.POST.get('startDate'),             'deadline' : request.POST.get('deadline'),             'priority' : request.POST.get('priority')         }          data = {k: v for k, v in data.items() if v is not None and v.strip() != ''}          refresh = RefreshToken.for_user(request.user)         access_token = str(refresh.access_token)         headers = {'Authorization': f'Bearer {access_token}'}          response = requests.patch(f'http://localhost:8000/api/tasks/{task_id}/', json=data, headers=headers)          if response.status_code == 200:             assignee_email = response.json().get('assignee_email')             send_task_email_to_assignee(assignee_email, data['title'])             return redirect('tasklist')         else:             print(f"Error: {response.status_code} - {response.text}")             return render(request, 'tasklist_create.html', {'error': response.json()})     else:         users = User.objects.all()         statuses = Task.Status.choices         priorities = Task.Priority.choices         return render(request, 'tasklist_update.html', {'users':users, 'statuses':statuses, 'priorities':priorities, 'task':current_task})`

### **3. Task Deletion**

- **Issue**: You needed to implement a DELETE request to remove a task and redirect the user appropriately.
- **Solution**:
    - Created a `task_delete` view function to handle task deletion through an API call and redirect to the `tasklist` page.
    - Fixed the form for deleting tasks and ensured that it properly POSTs to the `task_delete` URL.

**Added `task_delete` View Function:**

python

Code kopieren

`@login_required def task_delete(request, task_id):     if request.method == 'POST':         refresh = RefreshToken.for_user(request.user)         access_token = str(refresh.access_token)         headers = {'Authorization': f'Bearer {access_token}'}          response = requests.delete(f'http://localhost:8000/api/tasks/{task_id}/', headers=headers)          if response.status_code == 204:             return redirect('tasklist')         else:             print(f"Error: {response.status_code} - {response.text}")             return render(request, 'tasklist.html', {'error': 'Failed to delete the task'})     else:         current_task = get_object_or_404(Task, pk=task_id)         return render(request, 'tasklist_delete.html', {'task': current_task})`

**HTML Form for Deleting a Task:**

html

Code kopieren

`<form method="post" action="{% url 'task_delete' task.id %}">     {% csrf_token %}     <button type="submit">Confirm Delete</button>     <a href="{% url 'tasklist' %}">Cancel</a> </form>`

### **4. Redirection and Debugging**

- **Issue**: You were ending up at the `deletetask/13/` URL and needed to redirect to the `tasklist` page instead.
- **Solution**:
    - Verified the form action URL and method in the delete confirmation template.
    - Ensured the `task_delete` view function was set up to redirect properly after task deletion.

### **5. JavaScript for Client-Side Delete (Optional)**

- **Added an example for client-side deletion** to demonstrate how to handle DELETE requests using JavaScript:

javascript

Code kopieren

``document.querySelectorAll('.delete-task').forEach(button => {     button.addEventListener('click', async (event) => {         if (!confirm('Are you sure you want to delete this task?')) {             return;         }          const taskId = button.getAttribute('data-task-id');         const token = 'your_jwt_token'; // Replace with the actual JWT token retrieval method          try {             const response = await fetch(`/api/tasks/${taskId}/`, {                 method: 'DELETE',                 headers: {                     'Authorization': `Bearer ${token}`,                     'Content-Type': 'application/json'                 }             });              if (response.ok) {                 alert('Task deleted successfully');                 window.location.href = '{% url "tasklist" %}';  // Redirect to the task list page             } else {                 alert('Failed to delete the task');             }         } catch (error) {             console.error('Error:', error);         }     }); });``

### **6. API Endpoint for DELETE Requests**

- **Ensured that the `TaskListApiView` handles DELETE requests correctly** and returns the proper response:

python

Code kopieren

`class TaskListApiView(APIView):     # other methods...      def delete(self, request, *args, **kwargs):         task = self.get_task(kwargs.get('pk'))         task.delete()         return Response(status=status.HTTP_204_NO_CONTENT)`

### **Takeaways**

1. **CRUD Operations**: We implemented the basic CRUD operations (`Create`, `Read`, `Update`, `Delete`) for tasks using both Django views and the Django REST Framework API.
2. **Form Handling**: We fixed form submissions for creating and updating tasks, ensuring they properly send data and handle responses.
3. **API Communication**: We established correct API requests and responses for task management.
4. **Error Handling**: We added error handling to provide user feedback in case of failures.
5. **Redirection**: We ensured correct redirection to the `tasklist` page after successful operations.

### **Next Steps**

If you want to further enhance the task management system, consider these additional features:

- **User Notifications**: Send notifications for updates or deletions.
- **Advanced Filtering**: Add more complex filtering options for tasks.
- **Pagination**: Implement pagination for long task lists.
- **Task Search**: Add search functionality for tasks.
- **Task Comments**: Add a commenting feature for tasks.